#include <stdio.h>
#include "../headers/percistency_hub.h"

int main(){

	ENVIRONMENT *env = NULL;
	MODULE_WALLET *wallet = NULL;
	int i;

	// Test basic setup
	// autoset_environment(&env, "./malware");
	set_environment(&env, LINUX, X64, WITH_ROOT, "./malware");
	get_all_modules(&wallet);

	// Print basic information about infected machine
	printf("[+] Information about infected machine:\n");
	printf("- operating system: ");
	switch (env->operating_system){
		case WINDOWS:
			printf("Windows");
			break;
		case LINUX:
			printf("Linux");
			break;
		case OTHERS:
			printf("unknown");
			break;
	}
	printf("\n- having root: ");
	switch (env->is_root){
		case WITH_ROOT:
			printf("yes");
			break;
		case WITHOUT_ROOT:
			printf("no");
			break;
	}
	printf("\n- architecture: ");
	switch (env->architecture){
		case X32:
			printf("x32");
			break;
		case X64:
			printf("x64");
			break;
		case UNKNOWN:
			printf("unknown");
			break;
	}

	// Iterate
	printf("\n\n[+] Available modules:\n");
	for (i = 0; i < wallet->count; i++){
		printf("- %s\n", wallet->names[i]);
	}

	// Free
	free_environment(&env);
	free_module_wallet(&wallet);

}